<h2 id="pageTitle"></h2>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const today = new Date();

  const formattedDate = today.toLocaleDateString("en-GB", {
    day: "2-digit",
    month: "short",
    year: "numeric"
  });

  document.getElementById("pageTitle").textContent =
    `Update on tool releases`;
});
</script>

<input
  type="text"
  id="searchInput"
  placeholder="Search repository..."
  style="margin-bottom:10px; padding:6px; width:250px;"
/>

<select id="releaseFilter" style="margin-left:10px; padding:6px;">
  <option value="all">All</option>
  <option value="yes">Released in last 7 days</option>
  <option value="no">Not released in last 7 days</option>
</select>

<table border="1" cellpadding="8" cellspacing="0"
       style="border-collapse: collapse; width: 100%; margin-top:10px;">
  <thead>
    <tr style="background:#f5f5f5; cursor:pointer;">
      <th onclick="sortTable(0)">#</th>
      <th onclick="sortTable(1)">Repository ðŸ”½</th>
      <th onclick="sortTable(2)">Released in Last 7 Days ðŸ”½</th>
      <th onclick="sortTable(3)">Last Release Date ðŸ”½</th>
    </tr>
  </thead>
  <tbody id="releases-table"></tbody>
</table>

<script>
let sortDirection = {};

/* ---------- Sorting ---------- */
function sortTable(colIndex) {
  const tbody = document.getElementById("releases-table");
  const rows = Array.from(tbody.rows);
  const asc = sortDirection[colIndex] = !sortDirection[colIndex];

  rows.sort((a, b) => {
    let valA = a.cells[colIndex].innerText.toLowerCase();
    let valB = b.cells[colIndex].innerText.toLowerCase();
    return asc ? valA.localeCompare(valB) : valB.localeCompare(valA);
  });

  rows.forEach(row => tbody.appendChild(row));
}

/* ---------- Filtering ---------- */
document.getElementById("searchInput").addEventListener("input", filterTable);
document.getElementById("releaseFilter").addEventListener("change", filterTable);

function filterTable() {
  const searchText = document.getElementById("searchInput").value.toLowerCase();
  const filterValue = document.getElementById("releaseFilter").value;
  const rows = document.querySelectorAll("#releases-table tr");

  rows.forEach(row => {
    const repoText = row.cells[1].innerText.toLowerCase();
    const released = row.cells[2].innerText.toLowerCase();

    let visible = repoText.includes(searchText);

    if (filterValue === "yes" && released !== "yes") visible = false;
    if (filterValue === "no" && released !== "no") visible = false;

    row.style.display = visible ? "" : "none";
  });
}

/* ---------- Load JSON + Auto Calculate ---------- */
document.addEventListener("DOMContentLoaded", () => {
  fetch("data/releases.json")
    .then(res => res.json())
    .then(data => {
      const tableBody = document.getElementById("releases-table");
      tableBody.innerHTML = "";

      const today = new Date();
      const daysLimit = 7;

      data.forEach((item, index) => {
        const row = document.createElement("tr");

        const releaseDate = new Date(item.lastReleaseDate);
        const diffInDays = Math.floor(
          (today - releaseDate) / (1000 * 60 * 60 * 24)
        );

        const releasedRecently = diffInDays <= daysLimit ? "Yes" : "No";

        row.innerHTML = `
          <td>${index + 1}</td>
          <td>
            <a href="https://github.com/${item.repo}" target="_blank">
              ${item.repo}
            </a>
          </td>
          <td>${releasedRecently}</td>
          <td>${item.lastReleaseDate}</td>
        `;

        tableBody.appendChild(row);
      });
    })
    .catch(err => {
      console.error("Error loading JSON:", err);
    });
});
</script>
